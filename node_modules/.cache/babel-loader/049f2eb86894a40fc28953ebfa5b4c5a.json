{"remainingRequest":"D:\\GitHub\\Vectory\\node_modules\\babel-loader\\lib\\index.js!D:\\GitHub\\Vectory\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\GitHub\\Vectory\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\GitHub\\Vectory\\src\\components\\ArtBoard.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\GitHub\\Vectory\\src\\components\\ArtBoard.vue","mtime":1580428451722},{"path":"D:\\GitHub\\Vectory\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\GitHub\\Vectory\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\GitHub\\Vectory\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\GitHub\\Vectory\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _slicedToArray from \"D:\\\\GitHub\\\\Vectory\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.number.constructor\";\nimport _objectSpread from \"D:\\\\GitHub\\\\Vectory\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\nimport paper from \"paper\";\nimport { mapState, mapMutations } from \"vuex\";\nimport { bus } from \"@/main.js\";\nimport { get } from \"http\";\nimport Data from '@/Data.js';\nimport { GuideLines } from '@/mixins/GuideLines.js';\nexport default {\n  mixins: [GuideLines],\n  name: \"ArtBoard\",\n  computed: _objectSpread({}, mapState([\"SELECTED_LAYER_INDEX\", \"SELECTED\", \"LAYERS\", 'SCREEN_BORDER', 'OBJECTS', 'ACTIVE_TOOL'])),\n  methods: _objectSpread({}, mapMutations([\"SET_TOOLSELECT\", \"SET_TOOLPOINTER\", \"SET_TOOLPEN\", \"SET_TOOLCIRCLE\", \"SET_TOOLRECTANGLE\", \"SET_TOOLSHAPEBUILDER\", \"SET_TOOLLINE\", \"DELETE_SHAPES\", \"INSERT_LAYER\", \"SET_SELECTED_LAYER_INDEX\", \"SWAP_LAYERS\", \"REFRESH_LAYER_ARRAY\", \"SET_SCREEN_BORDER\", \"ADD_SELECT\", \"ADD_ACTION\", \"SET_UI_LAYER\"])),\n  mounted: function mounted() {\n    var _this = this;\n\n    // Clamp prototype\n    Number.prototype.clamp = function (min, max) {\n      return Math.min(Math.max(this, min), max);\n    };\n\n    var canvas = document.querySelector(\"#canvas\"); //#region PaperJS setup\n\n    paper.install(window);\n    paper.setup(\"canvas\");\n    paper.settings.handleSize = 8;\n    paper.settings.hitTolerance = 7;\n    /*value updated with zoom*/\n\n    var view = paper.view;\n    var border_w = Data.DOCUMENT_WIDTH;\n    var border_h = Data.DOCUMENT_HEIGHT;\n    var toolSelect = new Tool();\n    var toolPointer = new Tool();\n    var toolPen = new Tool();\n    var toolCircle = new Tool();\n    var toolRectangle = new Tool();\n    var toolShapebuilder = new Tool();\n    var toolLine = new Tool(); // Set global store references\n\n    this.SET_TOOLSELECT(toolSelect);\n    this.SET_TOOLPOINTER(toolPointer);\n    this.SET_TOOLPEN(toolPen);\n    this.SET_TOOLCIRCLE(toolCircle);\n    this.SET_TOOLRECTANGLE(toolRectangle);\n    this.SET_TOOLSHAPEBUILDER(toolShapebuilder);\n    this.SET_TOOLLINE(toolLine); //\n    //#region Layers\n\n    var layerLayout = {\n      0: project.addLayer(new Layer())\n    };\n    var layerCount = 1;\n\n    var setupCanvas = function setupCanvas() {\n      // Set the screen border\n      _this.SET_SCREEN_BORDER(new Path.Rectangle({\n        point: [Data.CENTER_HOR - border_w / 2, Data.CENTER_VER - border_h / 2],\n        size: [border_w, border_h],\n        strokeColor: '#969696'\n      })); // Create UI layer and add screen border\n\n\n      var UI_LAYER = project.addLayer(new Layer({\n        children: [_this.SCREEN_BORDER]\n      }));\n\n      _this.SET_UI_LAYER(UI_LAYER); // Create default layer\n\n\n      var defaultLayer = project.addLayer(new Layer());\n      defaultLayer.number = 0;\n      defaultLayer.name = \"Default\";\n      defaultLayer.activate();\n      layerLayout[0] = defaultLayer;\n\n      _this.INSERT_LAYER(defaultLayer);\n    };\n\n    setupCanvas();\n\n    var AddLayer = function AddLayer() {\n      var _newLayer = project.addLayer(new Layer());\n\n      _newLayer.number = layerCount;\n      _newLayer.name = \"Layer \" + layerCount;\n      layerLayout[layerCount] = _newLayer;\n\n      _newLayer.activate();\n\n      _this.INSERT_LAYER(_newLayer);\n\n      layerCount++;\n    };\n\n    var RemoveLayer = function RemoveLayer(number) {\n      for (var i = 0; i < layerLayout[number].children.length; i++) {\n        layerLayout[number].children[i].selectable = false;\n      }\n\n      layerLayout[number].data.deleted = true;\n      layerLayout[number].remove();\n\n      _this.SET_SELECTED_LAYER_INDEX(0);\n\n      _this.REFRESH_LAYER_ARRAY();\n    };\n\n    var MergeLayers = function MergeLayers(layers, bottom_index) {\n      layers[bottom_index - 1].addChildren(layers[bottom_index].children);\n      RemoveLayer(layers[bottom_index].number);\n    };\n\n    var UpdateActiveLayer = function UpdateActiveLayer(number) {\n      layerLayout[number].activate();\n\n      _this.SET_SELECTED_LAYER_INDEX(number);\n    };\n\n    var LayerSelectAll = function LayerSelectAll(number) {\n      var _children = layerLayout[number].children;\n\n      for (var i = 0; i < _this.OBJECTS.length; i++) {\n        if (_children.includes(_this.OBJECTS[i])) {\n          _this.ADD_SELECT(_this.OBJECTS[i]);\n\n          _this.OBJECTS[i].selected = true;\n        }\n      }\n\n      if (_this.ACTIVE_TOOL == 'select') {\n        bus.$emit('hide-transformbox');\n        bus.$emit('activate-select');\n      }\n    };\n\n    var LayerHideShapes = function LayerHideShapes(number) {\n      _this.DESELECT();\n\n      var _children = layerLayout[number].children;\n\n      for (var i = 0; i < _this.OBJECTS.length; i++) {\n        if (_children.includes(_this.OBJECTS[i])) {\n          _this.OBJECTS[i].selected = false;\n          _this.OBJECTS[i].visible = false;\n          _this.OBJECTS[i].selectable = false;\n        }\n      }\n    };\n\n    var LayerUnhideShapes = function LayerUnhideShapes(number) {\n      _this.DESELECT();\n\n      var _children = layerLayout[number].children;\n\n      for (var i = 0; i < _this.OBJECTS.length; i++) {\n        if (_children.includes(_this.OBJECTS[i])) {\n          _this.OBJECTS[i].selected = false;\n          _this.OBJECTS[i].visible = false;\n          _this.OBJECTS[i].selectable = false;\n        }\n      }\n    };\n\n    var getLayersFiltered = function getLayersFiltered() {\n      return _this.LAYERS.filter(function (el) {\n        return !el.data.deleted;\n      });\n    };\n\n    bus.$on(\"setup-canvas-border\", function () {\n      setupCanvas();\n    });\n    bus.$on(\"add-layer\", function () {\n      AddLayer();\n    });\n    bus.$on(\"remove-layer\", function () {\n      RemoveLayer(_this.SELECTED_LAYER_INDEX);\n    });\n    bus.$on(\"merge-layers\", function () {\n      var number = _this.SELECTED_LAYER_INDEX;\n      var layersFiltered = getLayersFiltered();\n\n      for (var i = 1; i < layersFiltered.length; i++) {\n        if (layersFiltered[i] == layerLayout[number]) {\n          MergeLayers(layersFiltered, i);\n        }\n      }\n    });\n    bus.$on(\"update-active-layer\", function (number) {\n      UpdateActiveLayer(number);\n    });\n    bus.$on(\"layer-select-all\", function (number) {\n      LayerSelectAll(number);\n    });\n    bus.$on(\"layer-hide-shapes\", function (number) {\n      LayerHideShapes(number);\n    });\n    bus.$on(\"layer-unhide-shapes\", function (number) {\n      LayerUnhideShapes(number);\n    });\n    bus.$on('move-layer-up', function (number) {\n      var first_index = -1;\n      var second_index = -1;\n\n      for (var i = _this.LAYERS.length - 1; i >= 0; i--) {\n        if (first_index == -1) {\n          if (_this.LAYERS[i] == layerLayout[number]) {\n            first_index = i;\n          }\n        } else if (second_index == -1) {\n          // Valid layer and don't allow to move above default layer\n          if (!_this.LAYERS[i].data.deleted && _this.LAYERS[i].number != 0) {\n            second_index = i;\n          }\n        }\n      }\n\n      if (first_index != -1 && second_index != -1) {\n        _this.LAYERS[second_index].insertAbove(_this.LAYERS[first_index]);\n\n        _this.SWAP_LAYERS({\n          first_index: first_index,\n          second_index: second_index\n        });\n      }\n    });\n    bus.$on('move-layer-down', function (number) {\n      // Don't allow to move the default layer\n      if (number == 0) return;\n      var first_index = -1;\n      var second_index = -1;\n\n      for (var i = 0; i < _this.LAYERS.length; i++) {\n        if (first_index == -1) {\n          if (_this.LAYERS[i] == layerLayout[number]) {\n            first_index = i;\n          }\n        } else if (second_index == -1) {\n          if (!_this.LAYERS[i].data.deleted) {\n            second_index = i;\n          }\n        }\n      }\n\n      if (first_index != -1 && second_index != -1) {\n        _this.LAYERS[first_index].insertAbove(_this.LAYERS[second_index]);\n\n        _this.SWAP_LAYERS({\n          first_index: first_index,\n          second_index: second_index\n        });\n      }\n    }); //\n    //#region Zoom\n\n    var zoomOffset = 0;\n\n    canvas.onwheel = function (e) {\n      bus.$emit(\"zoom\");\n      e.preventDefault();\n      var mousePos = new Point(e.clientX, e.clientY);\n      updateZoom(e.deltaY, mousePos);\n    };\n\n    function updateZoom(delta, mousePos) {\n      var mouseViewPos = view.viewToProject(mousePos);\n\n      var _changeZoomStable = changeZoomStable(view.zoom, delta, view.center, mouseViewPos);\n\n      var _changeZoomStable2 = _slicedToArray(_changeZoomStable, 2);\n\n      view.zoom = _changeZoomStable2[0];\n      zoomOffset = _changeZoomStable2[1];\n      view.center = view.center.add(zoomOffset);\n      view.draw(); // Pretty much hardcoded, this is to adjust the hitTolerance in respect to the zoom\n\n      settings.hitTolerance = (7 / view.zoom).clamp(0, 17);\n    }\n\n    function getNewZoom(oldZoom, delta) {\n      var factor = 1.05;\n\n      if (delta > 0) {\n        return oldZoom / factor;\n      } else if (delta < 0) {\n        return oldZoom * factor;\n      }\n    }\n\n    function changeZoomStable(oldZoom, delta, c, p) {\n      var newZoom = getNewZoom(oldZoom, delta).clamp(0.2, 10);\n      var beta = oldZoom / newZoom;\n      var pc = p.subtract(c);\n      var a = p.subtract(pc.multiply(beta)).subtract(c);\n      return [newZoom, a];\n    } //\n    //#region Key-Handling\n\n\n    var keys = {\n      del: false,\n      shift: false,\n      control: false,\n      z: false\n    };\n\n    var keyHandler = function keyHandler(e) {\n      if (!keys.del && e.code == \"Delete\" && !keys.control && !keys.shift) {\n        keys.del = true;\n\n        if (_this.SELECTED.length > 0) {\n          _this.DELETE_SHAPES({\n            undo: true\n          });\n        } // Let other components know (ToolSelect -> transform box must disappear)\n\n\n        bus.$emit(\"delete_selection\");\n\n        _this.updateGuidePoints();\n      } else if (!keys.shift && e.code == \"ShiftLeft\") {\n        keys.shift = true;\n        bus.$emit(\"shift\");\n      } else if (!keys.control && e.code == \"ControlLeft\") {\n        keys.control = true;\n        bus.$emit(\"control\");\n      } else if (!keys.z && e.key == \"z\") {\n        keys.z = true;\n\n        if (keys.control) {\n          bus.$emit(\"undo\");\n        }\n      } else if (!keys.z && e.key == \"Z\") {\n        keys.z = true;\n\n        if (keys.shift && keys.control) {\n          bus.$emit(\"redo\");\n        }\n      }\n    }; // --- Key checks ---\n\n\n    document.onkeydown = keyHandler;\n\n    document.onkeyup = function (e) {\n      if (e.code == \"ControlLeft\") {\n        bus.$emit(\"control_up\");\n      }\n\n      if (e.code == \"ShiftLeft\") {\n        keys.shift = false;\n        return;\n      }\n\n      if (e.key == \"z\") {\n        keys.z = false;\n        return;\n      }\n\n      if (e.key == \"Z\") {\n        keys.z = false;\n        return;\n      }\n\n      if (e.code == \"Delete\") {\n        keys.del = false;\n      }\n\n      keys.control = false;\n      keys.shift = false;\n      keys.del = false;\n      keys.z = false;\n    }; //\n\n  }\n};",{"version":3,"sources":["ArtBoard.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"art-board\">\r\n    <canvas id=\"canvas\" class=\"canvas\" resize></canvas>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport paper from \"paper\";\r\nimport { mapState, mapMutations } from \"vuex\";\r\nimport { bus } from \"@/main.js\";\r\nimport { get } from \"http\";\r\nimport Data from '@/Data.js'\r\nimport { GuideLines } from '@/mixins/GuideLines.js';\r\n\r\nexport default {\r\n  mixins: [GuideLines],\r\n  name: \"ArtBoard\",\r\n  computed: {\r\n    ...mapState([\r\n      \"SELECTED_LAYER_INDEX\",\r\n      \"SELECTED\",\r\n      \"LAYERS\",\r\n      'SCREEN_BORDER',\r\n      'OBJECTS',\r\n      'ACTIVE_TOOL'\r\n      ])\r\n  },\r\n  methods: {\r\n    ...mapMutations([\r\n      \"SET_TOOLSELECT\",\r\n      \"SET_TOOLPOINTER\",\r\n      \"SET_TOOLPEN\",\r\n      \"SET_TOOLCIRCLE\",\r\n      \"SET_TOOLRECTANGLE\",\r\n      \"SET_TOOLSHAPEBUILDER\",\r\n      \"SET_TOOLLINE\",\r\n      \"DELETE_SHAPES\",\r\n      \"INSERT_LAYER\",\r\n      \"SET_SELECTED_LAYER_INDEX\",\r\n      \"SWAP_LAYERS\",\r\n      \"REFRESH_LAYER_ARRAY\",\r\n      \"SET_SCREEN_BORDER\",\r\n      \"ADD_SELECT\",\r\n      \"ADD_ACTION\",\r\n      \"SET_UI_LAYER\"\r\n    ])\r\n  },\r\n  mounted: function() {\r\n    // Clamp prototype\r\n    Number.prototype.clamp = function(min, max) {\r\n      return Math.min(Math.max(this, min), max);\r\n    };\r\n\r\n    const canvas = document.querySelector(\"#canvas\");\r\n\r\n    //#region PaperJS setup\r\n    paper.install(window);\r\n    paper.setup(\"canvas\");\r\n\r\n    paper.settings.handleSize = 8;\r\n    paper.settings.hitTolerance = 7; /*value updated with zoom*/\r\n\r\n    const view = paper.view;\r\n\r\n    let border_w = Data.DOCUMENT_WIDTH;\r\n    let border_h = Data.DOCUMENT_HEIGHT;\r\n\r\n    const toolSelect = new Tool();\r\n    const toolPointer = new Tool();\r\n    const toolPen = new Tool();\r\n    const toolCircle = new Tool();\r\n    const toolRectangle = new Tool();\r\n    const toolShapebuilder = new Tool();\r\n    const toolLine = new Tool();\r\n\r\n    // Set global store references\r\n    this.SET_TOOLSELECT(toolSelect);\r\n    this.SET_TOOLPOINTER(toolPointer);\r\n    this.SET_TOOLPEN(toolPen);\r\n    this.SET_TOOLCIRCLE(toolCircle);\r\n    this.SET_TOOLRECTANGLE(toolRectangle);\r\n    this.SET_TOOLSHAPEBUILDER(toolShapebuilder);\r\n    this.SET_TOOLLINE(toolLine);\r\n    //\r\n\r\n  //#region Layers\r\n    const layerLayout = {\r\n      0: project.addLayer(new Layer())\r\n    };\r\n\r\n    let layerCount = 1;\r\n\r\n    let setupCanvas = () => {\r\n      // Set the screen border\r\n      this.SET_SCREEN_BORDER(new Path.Rectangle({\r\n        point: [\r\n          Data.CENTER_HOR - border_w/2, \r\n          Data.CENTER_VER - border_h/2\r\n        ],\r\n        size: [border_w, border_h],\r\n        strokeColor: '#969696'\r\n      }));\r\n\r\n      // Create UI layer and add screen border\r\n      const UI_LAYER = project.addLayer(new Layer({\r\n        children: [this.SCREEN_BORDER]\r\n      }));\r\n\r\n      this.SET_UI_LAYER(UI_LAYER);\r\n\r\n      // Create default layer\r\n      let defaultLayer = project.addLayer(new Layer());\r\n      defaultLayer.number = 0;\r\n      defaultLayer.name = \"Default\";\r\n      defaultLayer.activate();\r\n\r\n      layerLayout[0] = defaultLayer;\r\n\r\n      this.INSERT_LAYER(defaultLayer);\r\n    }\r\n\r\n    setupCanvas();\r\n\r\n    let AddLayer = () => {\r\n      let _newLayer = project.addLayer(new Layer());\r\n      _newLayer.number = layerCount;\r\n      _newLayer.name = \"Layer \" + layerCount;\r\n      layerLayout[layerCount] = _newLayer;\r\n      _newLayer.activate();\r\n      this.INSERT_LAYER(_newLayer);\r\n      layerCount++;\r\n    };\r\n\r\n    let RemoveLayer = (number) => {\r\n      for(let i=0; i<layerLayout[number].children.length; i++) {\r\n        layerLayout[number].children[i].selectable=false;\r\n      }\r\n\r\n      layerLayout[number].data.deleted = true;\r\n      layerLayout[number].remove();\r\n\r\n      this.SET_SELECTED_LAYER_INDEX(0);\r\n\r\n      this.REFRESH_LAYER_ARRAY();\r\n    };\r\n\r\n    let MergeLayers = (layers, bottom_index) => {\r\n      layers[bottom_index-1].addChildren(layers[bottom_index].children);\r\n      RemoveLayer(layers[bottom_index].number);\r\n    };\r\n\r\n    let UpdateActiveLayer = (number) => {\r\n      layerLayout[number].activate();\r\n      this.SET_SELECTED_LAYER_INDEX(number);\r\n    };\r\n\r\n    let LayerSelectAll = (number) => {\r\n      let _children = layerLayout[number].children;\r\n      for(let i=0; i<this.OBJECTS.length; i++) {\r\n        if(_children.includes(this.OBJECTS[i])) {\r\n          this.ADD_SELECT(this.OBJECTS[i]);\r\n          this.OBJECTS[i].selected = true;\r\n        }\r\n      }\r\n\r\n      if(this.ACTIVE_TOOL == 'select') {\r\n        bus.$emit('hide-transformbox');\r\n        bus.$emit('activate-select');\r\n      }\r\n    }\r\n\r\n    let LayerHideShapes = (number) => {\r\n      this.DESELECT();\r\n\r\n      let _children = layerLayout[number].children;\r\n      for(let i=0; i<this.OBJECTS.length; i++) {\r\n        if(_children.includes(this.OBJECTS[i])) {\r\n          this.OBJECTS[i].selected = false;\r\n          this.OBJECTS[i].visible = false;\r\n          this.OBJECTS[i].selectable = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    let LayerUnhideShapes = (number) => {\r\n      this.DESELECT();\r\n\r\n      let _children = layerLayout[number].children;\r\n      for(let i=0; i<this.OBJECTS.length; i++) {\r\n        if(_children.includes(this.OBJECTS[i])) {\r\n          this.OBJECTS[i].selected = false;\r\n          this.OBJECTS[i].visible = false;\r\n          this.OBJECTS[i].selectable = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    let getLayersFiltered = () => {\r\n      return this.LAYERS.filter(function(el) {\r\n        return !el.data.deleted;\r\n      });\r\n    }\r\n\r\n    bus.$on(\"setup-canvas-border\", () => {\r\n      setupCanvas();\r\n    });\r\n    bus.$on(\"add-layer\", () => {\r\n      AddLayer();\r\n    });\r\n    bus.$on(\"remove-layer\", () => {\r\n      RemoveLayer(this.SELECTED_LAYER_INDEX);\r\n    });\r\n    bus.$on(\"merge-layers\", () => {\r\n      let number = this.SELECTED_LAYER_INDEX;\r\n      let layersFiltered = getLayersFiltered();\r\n\r\n      for(let i=1; i<layersFiltered.length; i++) {\r\n        if(layersFiltered[i] == layerLayout[number]) {\r\n          MergeLayers(layersFiltered, i);\r\n        }\r\n      }\r\n    });\r\n    bus.$on(\"update-active-layer\", (number) => {\r\n      UpdateActiveLayer(number);\r\n    });\r\n    bus.$on(\"layer-select-all\", (number) => {\r\n      LayerSelectAll(number);\r\n    });\r\n    bus.$on(\"layer-hide-shapes\", (number) => {\r\n      LayerHideShapes(number);\r\n    });\r\n    bus.$on(\"layer-unhide-shapes\", (number) => {\r\n      LayerUnhideShapes(number);\r\n    });\r\n    bus.$on('move-layer-up', (number) => {\r\n      let first_index = -1;\r\n      let second_index = -1;\r\n      for(let i=this.LAYERS.length-1; i >= 0; i--) {\r\n        if(first_index == -1) {\r\n          if(this.LAYERS[i] == layerLayout[number]) {\r\n            first_index = i;\r\n          }\r\n        }\r\n        else if(second_index == -1) {\r\n          // Valid layer and don't allow to move above default layer\r\n          if(!this.LAYERS[i].data.deleted && this.LAYERS[i].number != 0) {\r\n            second_index = i;\r\n          }\r\n        }\r\n      }\r\n\r\n      if(first_index != -1 && second_index != -1) {\r\n        this.LAYERS[second_index].insertAbove(this.LAYERS[first_index]);\r\n        this.SWAP_LAYERS({first_index, second_index});\r\n      }\r\n    });\r\n    bus.$on('move-layer-down', (number) => {\r\n      // Don't allow to move the default layer\r\n      if(number == 0)\r\n        return;\r\n      \r\n      let first_index = -1;\r\n      let second_index = -1;\r\n      for(let i=0; i < this.LAYERS.length; i++) {\r\n        if(first_index == -1) {\r\n          if(this.LAYERS[i] == layerLayout[number]) {\r\n            first_index = i;\r\n          }\r\n        }\r\n        else if(second_index == -1) {\r\n          if(!this.LAYERS[i].data.deleted) {\r\n            second_index = i;\r\n          }\r\n        }\r\n      }\r\n\r\n      if(first_index != -1 && second_index != -1) {\r\n        this.LAYERS[first_index].insertAbove(this.LAYERS[second_index]);\r\n        this.SWAP_LAYERS({first_index, second_index});\r\n      }\r\n    });\r\n    //\r\n\r\n    //#region Zoom\r\n    let zoomOffset = 0;\r\n\r\n    canvas.onwheel = function(e) {\r\n      bus.$emit(\"zoom\");\r\n      e.preventDefault();\r\n\r\n      const mousePos = new Point(e.clientX, e.clientY);\r\n      updateZoom(e.deltaY, mousePos);\r\n    };\r\n\r\n    function updateZoom(delta, mousePos) {\r\n      const mouseViewPos = view.viewToProject(mousePos);\r\n      [view.zoom, zoomOffset] = changeZoomStable(\r\n        view.zoom,\r\n        delta,\r\n        view.center,\r\n        mouseViewPos\r\n      );\r\n      view.center = view.center.add(zoomOffset);\r\n      view.draw();\r\n\r\n      // Pretty much hardcoded, this is to adjust the hitTolerance in respect to the zoom\r\n      settings.hitTolerance = (7 / view.zoom).clamp(0, 17);\r\n    }\r\n\r\n    function getNewZoom(oldZoom, delta) {\r\n      const factor = 1.05;\r\n\r\n      if (delta > 0) {\r\n        return oldZoom / factor;\r\n      } else if (delta < 0) {\r\n        return oldZoom * factor;\r\n      }\r\n    }\r\n\r\n    function changeZoomStable(oldZoom, delta, c, p) {\r\n      var newZoom = getNewZoom(oldZoom, delta).clamp(0.2, 10);\r\n      var beta = oldZoom / newZoom;\r\n      var pc = p.subtract(c);\r\n      var a = p.subtract(pc.multiply(beta)).subtract(c);\r\n\r\n      return [newZoom, a];\r\n    }\r\n    //\r\n\r\n    //#region Key-Handling\r\n    var keys = {\r\n      del: false,\r\n      shift: false,\r\n      control: false,\r\n      z: false\r\n    };\r\n\r\n    let keyHandler = e => {\r\n      if (!keys.del && e.code == \"Delete\" && !keys.control && !keys.shift) {\r\n        keys.del = true;\r\n        if(this.SELECTED.length > 0) {\r\n          this.DELETE_SHAPES({undo: true});\r\n        }\r\n\r\n        // Let other components know (ToolSelect -> transform box must disappear)\r\n        bus.$emit(\"delete_selection\");\r\n\r\n        this.updateGuidePoints();\r\n\r\n      } else if (!keys.shift && e.code == \"ShiftLeft\") {\r\n        keys.shift = true;\r\n        bus.$emit(\"shift\");\r\n      } else if (!keys.control && e.code == \"ControlLeft\") {\r\n        keys.control = true;\r\n        bus.$emit(\"control\");\r\n      } else if (!keys.z && e.key == \"z\") {\r\n        keys.z = true;\r\n\r\n        if(keys.control) {\r\n          bus.$emit(\"undo\");\r\n        }\r\n      } else if (!keys.z && e.key == \"Z\") {\r\n        keys.z = true;\r\n\r\n        if(keys.shift && keys.control) {\r\n          bus.$emit(\"redo\");\r\n        }\r\n      }\r\n    };\r\n\r\n    // --- Key checks ---\r\n    document.onkeydown = keyHandler;\r\n\r\n    document.onkeyup = function(e) {\r\n      if (e.code == \"ControlLeft\") {\r\n        bus.$emit(\"control_up\");\r\n      }\r\n      if (e.code == \"ShiftLeft\") {\r\n        keys.shift = false;\r\n        return;\r\n      }\r\n      if (e.key == \"z\") {\r\n        keys.z = false;\r\n        return;\r\n      }\r\n      if (e.key == \"Z\") {\r\n        keys.z = false;\r\n        return;\r\n      }\r\n      if (e.code == \"Delete\") {\r\n        keys.del = false;\r\n      }\r\n\r\n      keys.control = false;\r\n      keys.shift = false;\r\n      keys.del = false;\r\n      keys.z = false;\r\n    };\r\n    //\r\n  }\r\n};\r\n</script>\r\n\r\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\r\n<style scoped>\r\n.canvas {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n  z-index: 0;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components"}]}